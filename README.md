# secondkillmall


## 项目环境搭建

1.SpringBoot环境搭建

2.集成Thymeleaf

3.Mybatis

## 分布式会话

1.用户登录。明文密码二次MD5加密

2.参数校验+全局异常处理

3.共享Session使用redis实现

## 功能开发

1.商品列表

2.商品详情

3.秒杀

4.订单详情

## 系统压测

1.JMeter工具

2.自定义变量模拟多用户

3.压测商品列表和秒杀



## 优化思路步骤

①缓存页面，将整个页面内容缓存进入redis，但是这样的话每次传输其实还是传输了整个页面。

②页面静态化，优化商品详情页和订单页，因为这两个页面只有一个商品，所以将页面设置为静态的，使用ajax发送请求，然后用jquery设置页面内容。

③将秒杀的商品以及库存放入redis中，先判断redis中的库存是否大于0，如果是就对redis的库存减1。

④当redis中的库存小于0是，后续用户还会查询redis，我们可以用一个HashMap记录库存，对于哈希表中库存小于等于0的，直接返回错误；

⑤将下订单的请求放入RabbitMQ中，让消费者处理，前端用户轮询，达到削峰效果

⑥将使用redis查库存减库存的操作放入lua脚本中，可以保证原子性。

⑦为了防止黄牛获取接口之后使用脚本调用，在秒杀之前，我们先让用户获取接口，在接口中加入UUID并绑定用户和秒杀的商品id，放入redis中。然后用户使用获取的专属接口去秒杀。

⑧为了防止秒杀刚开始请求过多，我们加入验证码，输入正确的验证码后才可以获取接口然后秒杀

⑨使用redis记录用户访问的url，记录30s访问次数，大于5次就提示请求频繁。然后将限流使用注解实现。

## 解决超卖思路

①首先查询数据库判断商品库存是否小于等于0，小于等于0就返回失败；

②尝试从redis中获取用户相关的订单，key为`order:+用户id+":"+商品id`，如果redis中不存在，就开始秒杀。

③秒杀时的减库存操作实则时高并发操作，使用sql语句进行减库存
